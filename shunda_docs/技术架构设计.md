# æŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡£

> **ä½œè€…**: å­™é¡ºè¾¾
> **é¡¹ç›®**: åŸºäº Midscene.js çš„ AI é©±åŠ¨è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°
> **ç‰ˆæœ¬**: v1.0
> **æ—¥æœŸ**: 2025-01-12

---

## ğŸ“‹ ç›®å½•

- [1. æ¶æ„æ¦‚è§ˆ](#1-æ¶æ„æ¦‚è§ˆ)
- [2. æŠ€æœ¯é€‰å‹](#2-æŠ€æœ¯é€‰å‹)
- [3. æ ¸å¿ƒæ¨¡å—è®¾è®¡](#3-æ ¸å¿ƒæ¨¡å—è®¾è®¡)
- [4. æ¥å£è®¾è®¡](#4-æ¥å£è®¾è®¡)
- [5. æ•°æ®æµè®¾è®¡](#5-æ•°æ®æµè®¾è®¡)
- [6. Python-Node.js é›†æˆæ–¹æ¡ˆ](#6-python-nodejs-é›†æˆæ–¹æ¡ˆ)
- [7. å®‰å…¨æ€§è®¾è®¡](#7-å®‰å…¨æ€§è®¾è®¡)
- [8. æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ](#8-æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ)
- [9. éƒ¨ç½²æ–¹æ¡ˆ](#9-éƒ¨ç½²æ–¹æ¡ˆ)
- [10. ç›‘æ§å’Œæ—¥å¿—](#10-ç›‘æ§å’Œæ—¥å¿—)

---

## 1. æ¶æ„æ¦‚è§ˆ

### 1.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç•Œé¢å±‚                             â”‚
â”‚                      Gradio WebUI                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ LLMé…ç½®â”‚æµè§ˆå™¨  â”‚æµ‹è¯•ç”¨ä¾‹â”‚PRDç”Ÿæˆ â”‚æµ‹è¯•æ‰§è¡Œâ”‚æ“ä½œè¯´æ˜â”‚    â”‚
â”‚  â”‚        â”‚è®¾ç½®    â”‚ç®¡ç†    â”‚ç”¨ä¾‹    â”‚        â”‚        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸šåŠ¡é€»è¾‘å±‚ (Python)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚PRDProcessor    â”‚TestCaseManager â”‚ReportGenerator â”‚       â”‚
â”‚  â”‚- parse_prd()   â”‚- parse_yaml()  â”‚- parse_report()â”‚       â”‚
â”‚  â”‚- generate_yamlâ”‚- validate_yaml()â”‚- generate_html()â”‚       â”‚
â”‚  â”‚- call_llm()    â”‚- execute_yaml() â”‚- export_pdf()  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Midscene æ¡¥æ¥å±‚ (Node.js)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ execute.js                                       â”‚       â”‚
â”‚  â”‚ - executeYaml(yamlPath, config)                  â”‚       â”‚
â”‚  â”‚ - createBrowser()                                â”‚       â”‚
â”‚  â”‚ - createAgent()                                  â”‚       â”‚
â”‚  â”‚ - handleError()                                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                    é€šä¿¡æ–¹å¼: subprocess                       â”‚
â”‚                    æ•°æ®æ ¼å¼: JSON (stdin/stdout)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Midscene æ ¸å¿ƒå±‚ (TypeScript)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Agent  â”‚ YAML   â”‚ Insightâ”‚TaskCacheâ”‚AIModel    â”‚        â”‚
â”‚  â”‚        â”‚ Player â”‚        â”‚        â”‚Integration â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               æµè§ˆå™¨è‡ªåŠ¨åŒ–å±‚ (Playwright/Puppeteer)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  æµè§ˆå™¨    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€æœ¯æ ˆæ€»è§ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **å‰ç«¯** | Gradio | 4.16.0 | Web UI æ¡†æ¶ |
| **åç«¯** | Python | 3.9+ | ä¸šåŠ¡é€»è¾‘å¤„ç† |
| **è‡ªåŠ¨åŒ–å¼•æ“** | Midscene.js | 0.30.8 | æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œ |
| **æµè§ˆå™¨é©±åŠ¨** | Playwright | 1.40+ | æµè§ˆå™¨æ§åˆ¶ |
| **LLM** | DeepSeek-V3 | - | PRD åˆ†æã€ç”¨ä¾‹ç”Ÿæˆ |
| **VLM** | Qwen2.5-VL | - | è§†è§‰ç†è§£ã€å…ƒç´ å®šä½ |
| **æ•°æ®æ ¼å¼** | YAML | - | æµ‹è¯•ç”¨ä¾‹æ ‡å‡†æ ¼å¼ |
| **é…ç½®ç®¡ç†** | .env | - | ç¯å¢ƒå˜é‡ç®¡ç† |

---

## 2. æŠ€æœ¯é€‰å‹

### 2.1 å‰ç«¯æ¡†æ¶: Gradio

**é€‰æ‹©ç†ç”±**:
- âœ… Python åŸç”Ÿ,æ— éœ€å­¦ä¹  JavaScript
- âœ… å¿«é€Ÿæ„å»º,å¼€å‘æ•ˆç‡é«˜
- âœ… å†…ç½®ç»„ä»¶ä¸°å¯Œ (æ–‡ä»¶ä¸Šä¼ ã€ä»£ç ç¼–è¾‘å™¨ç­‰)
- âœ… é€‚åˆå†…éƒ¨å·¥å…·å’Œ Demo

**æ›¿ä»£æ–¹æ¡ˆ**:
- Streamlit: ç±»ä¼¼ Gradio,ä½†ç»„ä»¶ç›¸å¯¹ç®€å•
- Flask + Vue.js: çµæ´»ä½†å¼€å‘å‘¨æœŸé•¿

### 2.2 åç«¯è¯­è¨€: Python

**é€‰æ‹©ç†ç”±**:
- âœ… Gradio æ˜¯ Python æ¡†æ¶
- âœ… AI/ML ç”Ÿæ€ä¸°å¯Œ (LLM SDKã€æ•°æ®å¤„ç†ç­‰)
- âœ… å¼€å‘æ•ˆç‡é«˜
- âœ… æ˜“äºç»´æŠ¤

### 2.3 è‡ªåŠ¨åŒ–å¼•æ“: Midscene.js

**é€‰æ‹©ç†ç”±**:
- âœ… æˆç†Ÿç¨³å®š (0.30.8 ç‰ˆæœ¬)
- âœ… å®Œæ•´çš„ YAML æ”¯æŒ
- âœ… å†…ç½®æŠ¥å‘Šç”Ÿæˆ
- âœ… å†…ç½®ç¼“å­˜æœºåˆ¶
- âœ… å¤šå¹³å°æ”¯æŒ (Web/Android/iOS)

**ä¸ºä»€ä¹ˆä¸ç”¨ browser-use?**
- Midscene YAML æ ¼å¼æ›´æ ‡å‡†
- Midscene åŠŸèƒ½æ›´å®Œæ•´ (æŠ¥å‘Šã€ç¼“å­˜)
- Midscene ç¤¾åŒºæ›´æ´»è·ƒ

### 2.4 æµè§ˆå™¨é©±åŠ¨: Playwright

**é€‰æ‹©ç†ç”±**:
- âœ… ç°ä»£åŒ– API
- âœ… è·¨æµè§ˆå™¨æ”¯æŒ
- âœ… Midscene å·²é›†æˆ
- âœ… æ–‡æ¡£å®Œå–„

**å¤‡é€‰æ–¹æ¡ˆ**: Puppeteer (å…¼å®¹æ€§æ›´å¥½)

### 2.5 LLM æœåŠ¡å•†

| ç”¨é€” | æ¨¡å‹ | æä¾›å•† | ç†ç”± |
|------|------|--------|------|
| PRD åˆ†æ | DeepSeek-V3 | DeepSeek | æ¨ç†èƒ½åŠ›å¼ºã€æˆæœ¬ä½ |
| ç”¨ä¾‹ç”Ÿæˆ | DeepSeek-V3 | DeepSeek | ç”Ÿæˆè´¨é‡é«˜ |
| å…ƒç´ å®šä½ | Qwen2.5-VL | SiliconFlow | è§†è§‰ç†è§£èƒ½åŠ›å¼º |
| ä»»åŠ¡è§„åˆ’ | Qwen2.5-VL | SiliconFlow | æ€§ä»·æ¯”é«˜ |

---

## 3. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 3.1 PRDProcessor (PRD å¤„ç†å™¨)

**èŒè´£**: å¤„ç† PRD æ–‡æ¡£,ç”Ÿæˆ YAML æµ‹è¯•ç”¨ä¾‹

**ç±»å›¾**:
```
PRDProcessor
â”œâ”€â”€ parse_prd(prd_content: str) -> Dict
â”‚   â””â”€â”€ è§£æ PRD,æå–å…³é”®ä¿¡æ¯
â”œâ”€â”€ generate_yaml(prd_content: str, context?: str) -> Dict
â”‚   â””â”€â”€ è°ƒç”¨ LLM ç”Ÿæˆ YAML
â”œâ”€â”€ _call_llm_api(prompt: str) -> str
â”‚   â””â”€â”€ è°ƒç”¨ DeepSeek API
â””â”€â”€ _extract_yaml_from_response(response: str) -> str
    â””â”€â”€ ä» LLM å“åº”ä¸­æå– YAML
```

**æ¥å£å®šä¹‰**:

```python
class PRDProcessor:
    def __init__(self):
        self.api_key: str
        self.base_url: str
        self.model: str
        self.prompt_template: str

    def parse_prd(self, prd_content: str) -> Dict:
        """
        è§£æ PRD æ–‡æ¡£

        Args:
            prd_content: PRD æ–‡æœ¬å†…å®¹

        Returns:
            {
                'content': str,      # å®Œæ•´å†…å®¹
                'length': int,       # å­—ç¬¦æ•°
                'word_count': int,   # å•è¯æ•°
                'has_url': bool      # æ˜¯å¦åŒ…å« URL
            }
        """

    def generate_yaml(
        self,
        prd_content: str,
        additional_context: Optional[str] = None
    ) -> Dict:
        """
        ç”Ÿæˆ YAML æµ‹è¯•ç”¨ä¾‹

        Args:
            prd_content: PRD å†…å®¹
            additional_context: é¢å¤–ä¸Šä¸‹æ–‡ (å¯é€‰)

        Returns:
            æˆåŠŸ:
            {
                'status': 'success',
                'yaml_content': str,
                'message': str
            }

            å¤±è´¥:
            {
                'status': 'error',
                'message': str
            }
        """
```

**æ•°æ®æµ**:
```
PRD æ–‡æœ¬
    â†“
parse_prd() â†’ æå–ä¿¡æ¯
    â†“
generate_yaml() â†’ æ„å»º Prompt
    â†“
_call_llm_api() â†’ è°ƒç”¨ DeepSeek API
    â†“
_extract_yaml_from_response() â†’ æå– YAML
    â†“
è¿”å› YAML æ–‡æœ¬
```

---

### 3.2 TestCaseManager (æµ‹è¯•ç”¨ä¾‹ç®¡ç†å™¨)

**èŒè´£**: è§£æã€éªŒè¯å’Œæ‰§è¡Œ YAML æµ‹è¯•ç”¨ä¾‹

**ç±»å›¾**:
```
TestCaseManager
â”œâ”€â”€ parse_yaml(yaml_content: str) -> Dict
â”‚   â””â”€â”€ è§£æ YAML æ ¼å¼
â”œâ”€â”€ validate_yaml(parsed_data: Dict) -> Dict
â”‚   â””â”€â”€ éªŒè¯ YAML æ ¼å¼å’Œå¿…å¡«å­—æ®µ
â”œâ”€â”€ extract_tasks(parsed_data: Dict) -> List[Dict]
â”‚   â””â”€â”€ æå–ä»»åŠ¡åˆ—è¡¨
â”œâ”€â”€ execute_yaml(yaml_content: str, config?: Dict) -> Dict
â”‚   â””â”€â”€ æ‰§è¡Œ YAML æµ‹è¯•ç”¨ä¾‹
â””â”€â”€ _call_node_script(yaml_path: str, config: Dict) -> Dict
    â””â”€â”€ è°ƒç”¨ Node.js æ‰§è¡Œè„šæœ¬
```

**æ¥å£å®šä¹‰**:

```python
class TestCaseManager:
    def __init__(self):
        self.node_script_path: str  # Node.js è„šæœ¬è·¯å¾„

    def parse_yaml(self, yaml_content: str) -> Dict:
        """
        è§£æ YAML æµ‹è¯•ç”¨ä¾‹

        Returns:
            æˆåŠŸ:
            {
                'status': 'success',
                'data': dict,           # è§£æåçš„ Python å­—å…¸
                'message': str
            }

            å¤±è´¥:
            {
                'status': 'error',
                'message': str          # é”™è¯¯ä¿¡æ¯
            }
        """

    def validate_yaml(self, parsed_data: Dict) -> Dict:
        """
        éªŒè¯ YAML æ ¼å¼

        Returns:
            {
                'valid': bool,
                'errors': List[str],    # é”™è¯¯åˆ—è¡¨
                'warnings': List[str]   # è­¦å‘Šåˆ—è¡¨
            }
        """

    def extract_tasks(self, parsed_data: Dict) -> List[Dict]:
        """
        æå–ä»»åŠ¡åˆ—è¡¨

        Returns:
            [
                {
                    'index': int,
                    'name': str,
                    'steps_count': int,
                    'description': str
                },
                ...
            ]
        """

    def execute_yaml(
        self,
        yaml_content: str,
        config: Optional[Dict] = None
    ) -> Dict:
        """
        æ‰§è¡Œ YAML æµ‹è¯•ç”¨ä¾‹

        Args:
            yaml_content: YAML å†…å®¹
            config: æ‰§è¡Œé…ç½®
                {
                    'headless': bool,
                    'outputDir': str,
                    'timeout': int
                }

        Returns:
            æˆåŠŸ:
            {
                'status': 'success',
                'data': {
                    'report_path': str,
                    'duration': float,
                    'tasks_count': int,
                    'timestamp': str
                },
                'message': str
            }

            å¤±è´¥:
            {
                'status': 'error',
                'message': str,
                'details': dict
            }
        """
```

**æ‰§è¡Œæµç¨‹**:
```
YAML å†…å®¹
    â†“
ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶ /tmp/testcase_xxx.yaml
    â†“
æ„å»º subprocess å‘½ä»¤
    â†“
è°ƒç”¨ Node.js: node execute.js <yaml_path> <config_json>
    â†“
Node.js æ‰§è¡Œ Midscene
    â†“
è¿”å›ç»“æœ (JSON via stdout)
    â†“
è§£æç»“æœå¹¶è¿”å›
    â†“
æ¸…ç†ä¸´æ—¶æ–‡ä»¶
```

---

### 3.3 ReportGenerator (æŠ¥å‘Šç”Ÿæˆå™¨)

**èŒè´£**: è§£æå’Œå±•ç¤ºæµ‹è¯•æŠ¥å‘Š

**ç±»å›¾**:
```
ReportGenerator
â”œâ”€â”€ parse_midscene_report(report_path: str) -> Dict
â”‚   â””â”€â”€ è§£æ Midscene HTML æŠ¥å‘Š
â”œâ”€â”€ extract_summary(report_data: Dict) -> Dict
â”‚   â””â”€â”€ æå–æŠ¥å‘Šæ‘˜è¦
â””â”€â”€ generate_html(report_data: Dict) -> str
    â””â”€â”€ ç”Ÿæˆè‡ªå®šä¹‰ HTML æŠ¥å‘Š (è¿­ä»£ 2)
```

**æ¥å£å®šä¹‰**:

```python
class ReportGenerator:
    def parse_midscene_report(self, report_path: str) -> Dict:
        """
        è§£æ Midscene ç”Ÿæˆçš„æŠ¥å‘Š

        Returns:
            {
                'status': 'success',
                'report_path': str,
                'url': str  # file:// URL
            }
        """

    def extract_summary(self, report_data: Dict) -> Dict:
        """
        æå–æŠ¥å‘Šæ‘˜è¦

        Returns:
            {
                'total_tasks': int,
                'passed_tasks': int,
                'failed_tasks': int,
                'duration': float,
                'status': str  # 'success' | 'failure'
            }
        """
```

---

## 4. æ¥å£è®¾è®¡

### 4.1 Python â†’ Node.js æ¥å£

**é€šä¿¡æ–¹å¼**: subprocess

**å‘½ä»¤æ ¼å¼**:
```bash
node execute.js <yaml_path> <config_json>
```

**é…ç½®å‚æ•° (JSON)**:
```json
{
  "headless": false,
  "outputDir": "./reports",
  "groupName": "æµ‹è¯•æ‰§è¡Œ",
  "cache": false,
  "viewport": {
    "width": 1920,
    "height": 1080
  },
  "timeout": 300000
}
```

**è¿”å›æ ¼å¼ (stdout)**:

æˆåŠŸ:
```json
{
  "status": "success",
  "result": {
    "username": "test"
  },
  "report_path": "/path/to/report.html",
  "duration": 45.3,
  "tasks_count": 2,
  "timestamp": "2025-01-12T10:30:00.000Z"
}
```

å¤±è´¥:
```json
{
  "status": "error",
  "message": "Error message",
  "stack": "Error stack trace",
  "timestamp": "2025-01-12T10:30:00.000Z"
}
```

### 4.2 LLM API æ¥å£

**DeepSeek API**:

è¯·æ±‚:
```http
POST https://api.deepseek.com/v1/chat/completions
Authorization: Bearer <API_KEY>
Content-Type: application/json

{
  "model": "deepseek-chat",
  "messages": [
    {
      "role": "system",
      "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æµ‹è¯•ç”¨ä¾‹è®¾è®¡ä¸“å®¶ã€‚"
    },
    {
      "role": "user",
      "content": "<prompt>"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 4096
}
```

å“åº”:
```json
{
  "id": "chatcmpl-xxx",
  "object": "chat.completion",
  "created": 1234567890,
  "model": "deepseek-chat",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "ç”Ÿæˆçš„å†…å®¹"
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 100,
    "completion_tokens": 200,
    "total_tokens": 300
  }
}
```

### 4.3 Gradio äº‹ä»¶æ¥å£

**æŒ‰é’®ç‚¹å‡»äº‹ä»¶**:
```python
button.click(
    fn=handler_function,           # å¤„ç†å‡½æ•°
    inputs=[input1, input2],       # è¾“å…¥ç»„ä»¶åˆ—è¡¨
    outputs=[output1, output2]     # è¾“å‡ºç»„ä»¶åˆ—è¡¨
)
```

**æ–‡ä»¶ä¸Šä¼ äº‹ä»¶**:
```python
file_upload.change(
    fn=load_file_handler,
    inputs=[file_upload],
    outputs=[text_output]
)
```

---

## 5. æ•°æ®æµè®¾è®¡

### 5.1 PRD â†’ YAML æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·ä¸Šä¼  PRD     â”‚
â”‚    (Markdown/Text)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Gradio æ¥æ”¶      â”‚
â”‚    gr.File æˆ–       â”‚
â”‚    gr.Textbox       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. PRDProcessor     â”‚
â”‚    .parse_prd()     â”‚
â”‚    æå–ä¿¡æ¯         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ„å»º Prompt      â”‚
â”‚    ä½¿ç”¨æ¨¡æ¿         â”‚
â”‚    + PRD å†…å®¹       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. è°ƒç”¨ LLM API     â”‚
â”‚    DeepSeek-V3      â”‚
â”‚    ç”Ÿæˆ YAML        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æå– YAML        â”‚
â”‚    ä»å“åº”ä¸­æå–     â”‚
â”‚    ```yaml ... ```  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. è¿”å›ç»™å‰ç«¯       â”‚
â”‚    gr.Code æ˜¾ç¤º     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 YAML â†’ æ‰§è¡Œç»“æœæ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. YAML å†…å®¹        â”‚
â”‚    (ç”¨æˆ·è¾“å…¥)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. TestCaseManager  â”‚
â”‚    .parse_yaml()    â”‚
â”‚    è§£æä¸º Python dictâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. validate_yaml()  â”‚
â”‚    æ£€æŸ¥æ ¼å¼         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ (valid)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶   â”‚
â”‚    /tmp/test_xxx.yamlâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ„å»º subprocess  â”‚
â”‚    cmd: node execute.jsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Node.js æ‰§è¡Œ     â”‚
â”‚    execute.js       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Midscene Agent   â”‚
â”‚    .runYaml()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Playwright       â”‚
â”‚    æµè§ˆå™¨æ“ä½œ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. ç”ŸæˆæŠ¥å‘Š         â”‚
â”‚    report.html      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. è¿”å›ç»“æœ (JSON) â”‚
â”‚     via stdout      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. Python è§£æ     â”‚
â”‚     json.loads()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. å‰ç«¯å±•ç¤º        â”‚
â”‚     gr.Markdown     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Python-Node.js é›†æˆæ–¹æ¡ˆ

### 6.1 æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‰æ‹© |
|------|------|------|------|
| **subprocess** | ç®€å•ã€ç¨³å®šã€æ— ä¾èµ– | æ€§èƒ½ç•¥ä½ã€é€šä¿¡å¼€é”€ | âœ… é‡‡ç”¨ |
| HTTP API | å¼‚æ­¥ã€é«˜æ€§èƒ½ | éœ€è¦å¯åŠ¨æœåŠ¡ã€å¤æ‚ | âŒ |
| gRPC | é«˜æ€§èƒ½ã€ç±»å‹å®‰å…¨ | å­¦ä¹ æˆæœ¬é«˜ã€è¿‡åº¦è®¾è®¡ | âŒ |
| å…±äº«å†…å­˜ | æ€§èƒ½æœ€é«˜ | å®ç°å¤æ‚ã€è·¨å¹³å°é—®é¢˜ | âŒ |

### 6.2 subprocess å®ç°ç»†èŠ‚

**Python ç«¯**:

```python
import subprocess
import json
import os

def call_node_script(yaml_path: str, config: dict) -> dict:
    """
    è°ƒç”¨ Node.js è„šæœ¬

    Args:
        yaml_path: YAML æ–‡ä»¶è·¯å¾„
        config: é…ç½®å­—å…¸

    Returns:
        æ‰§è¡Œç»“æœå­—å…¸

    Raises:
        subprocess.TimeoutExpired: è¶…æ—¶
        subprocess.CalledProcessError: æ‰§è¡Œå¤±è´¥
        Exception: å…¶ä»–é”™è¯¯
    """

    # æ„å»ºå‘½ä»¤
    cmd = [
        'node',
        'src/midscene_bridge/execute.js',
        yaml_path,
        json.dumps(config, ensure_ascii=False)
    ]

    # æ‰§è¡Œ
    try:
        result = subprocess.run(
            cmd,
            capture_output=True,
            text=True,
            check=True,
            timeout=config.get('timeout', 300),  # é»˜è®¤ 5 åˆ†é’Ÿ
            env=os.environ.copy()  # ç»§æ‰¿ç¯å¢ƒå˜é‡
        )

        # è§£æè¾“å‡º
        output = json.loads(result.stdout)
        return output

    except subprocess.TimeoutExpired:
        raise Exception('æ‰§è¡Œè¶…æ—¶')

    except subprocess.CalledProcessError as e:
        # è§£æé”™è¯¯ä¿¡æ¯
        try:
            error = json.loads(e.stderr)
        except:
            error = {'message': e.stderr}
        raise Exception(f"æ‰§è¡Œå¤±è´¥: {error.get('message', 'æœªçŸ¥é”™è¯¯')}")

    except json.JSONDecodeError:
        raise Exception('è¿”å›ç»“æœæ ¼å¼é”™è¯¯')
```

**Node.js ç«¯**:

```javascript
// src/midscene_bridge/execute.js
import { PlaywrightAgent } from '@midscene/web/playwright';
import { chromium } from 'playwright';

async function main() {
  try {
    // 1. è§£æå‚æ•°
    const args = process.argv.slice(2);
    const yamlPath = args[0];
    const config = JSON.parse(args[1] || '{}');

    // 2. éªŒè¯å‚æ•°
    if (!yamlPath) {
      throw new Error('Missing yaml_path argument');
    }

    // 3. æ‰§è¡Œ
    const result = await executeYaml(yamlPath, config);

    // 4. è¾“å‡ºç»“æœ (stdout)
    console.log(JSON.stringify(result));

  } catch (error) {
    // 5. è¾“å‡ºé”™è¯¯ (stderr)
    console.error(JSON.stringify({
      status: 'error',
      message: error.message,
      stack: error.stack
    }));
    process.exit(1);
  }
}

async function executeYaml(yamlPath, config) {
  // ... æ‰§è¡Œé€»è¾‘ ...
}

main();
```

### 6.3 é”™è¯¯å¤„ç†

**é”™è¯¯ç±»å‹**:

1. **å‚æ•°é”™è¯¯**: YAML è·¯å¾„ä¸å­˜åœ¨
2. **æ‰§è¡Œè¶…æ—¶**: è¶…è¿‡ timeout æ—¶é—´
3. **æµè§ˆå™¨é”™è¯¯**: Playwright å¯åŠ¨å¤±è´¥
4. **ç½‘ç»œé”™è¯¯**: ç›®æ ‡ç½‘ç«™æ— æ³•è®¿é—®
5. **LLM é”™è¯¯**: AI æ¨¡å‹è°ƒç”¨å¤±è´¥
6. **YAML é”™è¯¯**: æ ¼å¼ä¸æ­£ç¡®

**å¤„ç†ç­–ç•¥**:

```python
def execute_yaml_with_error_handling(yaml_content, config):
    """æ‰§è¡Œ YAML å¹¶å¤„ç†å„ç§é”™è¯¯"""

    try:
        # æ‰§è¡Œ
        result = testcase_manager.execute_yaml(yaml_content, config)

        if result['status'] == 'success':
            return {
                'success': True,
                'data': result['data']
            }
        else:
            return {
                'success': False,
                'error': result['message'],
                'category': classify_error(result['message'])
            }

    except subprocess.TimeoutExpired:
        return {
            'success': False,
            'error': 'æ‰§è¡Œè¶…æ—¶,è¯·æ£€æŸ¥ç½‘ç»œæˆ–å¢åŠ è¶…æ—¶æ—¶é—´',
            'category': 'timeout'
        }

    except Exception as e:
        return {
            'success': False,
            'error': str(e),
            'category': 'unknown'
        }

def classify_error(message: str) -> str:
    """é”™è¯¯åˆ†ç±»"""
    if 'timeout' in message.lower():
        return 'timeout'
    elif 'network' in message.lower():
        return 'network'
    elif 'yaml' in message.lower():
        return 'yaml'
    elif 'api' in message.lower():
        return 'api'
    else:
        return 'unknown'
```

---

## 7. å®‰å…¨æ€§è®¾è®¡

### 7.1 API Key å®‰å…¨

**å­˜å‚¨æ–¹å¼**:
- âœ… å­˜å‚¨åœ¨ `.env` æ–‡ä»¶
- âœ… `.env` åŠ å…¥ `.gitignore`
- âœ… æä¾› `.env.example` æ¨¡æ¿

**å±•ç¤ºæ–¹å¼**:
- âœ… UI ä¸­ä½¿ç”¨ `type="password"` éšè—
- âœ… æ—¥å¿—ä¸­ä¸æ‰“å° API Key

**éªŒè¯æœºåˆ¶**:
- âœ… æä¾›"æµ‹è¯•è¿æ¥"åŠŸèƒ½
- âœ… å¯åŠ¨æ—¶æ£€æŸ¥ API Key æ˜¯å¦é…ç½®

### 7.2 æ–‡ä»¶ä¸Šä¼ å®‰å…¨

**é™åˆ¶æªæ–½**:
- âœ… é™åˆ¶æ–‡ä»¶ç±»å‹ (`.yaml`, `.yml`, `.md`, `.txt`)
- âœ… é™åˆ¶æ–‡ä»¶å¤§å° (< 10MB)
- âœ… éªŒè¯æ–‡ä»¶å†…å®¹æ ¼å¼

**ç¤ºä¾‹**:
```python
def validate_upload_file(file):
    """éªŒè¯ä¸Šä¼ æ–‡ä»¶"""

    # 1. æ£€æŸ¥æ–‡ä»¶å¤§å°
    max_size = 10 * 1024 * 1024  # 10MB
    if os.path.getsize(file.name) > max_size:
        raise ValueError('æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ (10MB)')

    # 2. æ£€æŸ¥æ–‡ä»¶ç±»å‹
    allowed_extensions = ['.yaml', '.yml', '.md', '.txt']
    ext = os.path.splitext(file.name)[1].lower()
    if ext not in allowed_extensions:
        raise ValueError(f'ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: {ext}')

    # 3. æ£€æŸ¥æ–‡ä»¶å†…å®¹
    try:
        with open(file.name, 'r', encoding='utf-8') as f:
            content = f.read()
            # åŸºæœ¬éªŒè¯
            if len(content) == 0:
                raise ValueError('æ–‡ä»¶å†…å®¹ä¸ºç©º')
    except UnicodeDecodeError:
        raise ValueError('æ–‡ä»¶ç¼–ç é”™è¯¯,è¯·ä½¿ç”¨ UTF-8')

    return True
```

### 7.3 å‘½ä»¤æ³¨å…¥é˜²æŠ¤

**é£é™©**: subprocess æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å†…å®¹

**é˜²æŠ¤æªæ–½**:
- âœ… ä¸ç›´æ¥æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
- âœ… å›ºå®šæ‰§è¡Œè„šæœ¬è·¯å¾„
- âœ… å‚æ•°ä½¿ç”¨ JSON ä¼ é€’,ä¸ä½¿ç”¨ shell æ‹¼æ¥

**å®‰å…¨ç¤ºä¾‹**:
```python
# âœ… å®‰å…¨: å›ºå®šè„šæœ¬,JSON å‚æ•°
cmd = [
    'node',
    '/path/to/execute.js',
    yaml_path,
    json.dumps(config)
]
subprocess.run(cmd, shell=False)  # shell=False

# âŒ ä¸å®‰å…¨: shell=True + å­—ç¬¦ä¸²æ‹¼æ¥
cmd = f"node /path/to/execute.js {yaml_path}"
subprocess.run(cmd, shell=True)  # å±é™©!
```

---

## 8. æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

### 8.1 ç¼“å­˜æœºåˆ¶

**Midscene å†…ç½®ç¼“å­˜**:
```javascript
// å¯ç”¨ç¼“å­˜
const agent = await PlaywrightAgent.create(page, {
  cache: {
    enabled: true,
    id: 'test-cache',
    strategy: 'read-write'
  }
});
```

**Python ç«¯ç¼“å­˜**:
```python
from functools import lru_cache

@lru_cache(maxsize=128)
def parse_yaml(yaml_content: str):
    """è§£æ YAML (å¸¦ç¼“å­˜)"""
    return yaml.safe_load(yaml_content)
```

### 8.2 å¹¶å‘ä¼˜åŒ– (è¿­ä»£ 2)

**æ‰¹é‡æµ‹è¯•å¹¶è¡Œæ‰§è¡Œ**:
```python
import asyncio
import concurrent.futures

async def execute_batch(test_cases: List[str]):
    """å¹¶è¡Œæ‰§è¡Œå¤šä¸ªæµ‹è¯•ç”¨ä¾‹"""

    with concurrent.futures.ProcessPoolExecutor(max_workers=3) as executor:
        futures = [
            executor.submit(execute_yaml, tc)
            for tc in test_cases
        ]

        results = [f.result() for f in futures]

    return results
```

### 8.3 LLM è°ƒç”¨ä¼˜åŒ–

**æµå¼å“åº”** (è¿­ä»£ 2):
```python
def generate_yaml_stream(prd_content: str):
    """æµå¼ç”Ÿæˆ YAML"""

    # å¯ç”¨ stream
    response = requests.post(
        url,
        json={
            'model': 'deepseek-chat',
            'messages': messages,
            'stream': True
        },
        stream=True
    )

    for line in response.iter_lines():
        # è§£æå¢é‡å†…å®¹
        chunk = parse_sse(line)
        yield chunk
```

---

## 9. éƒ¨ç½²æ–¹æ¡ˆ

### 9.1 æœ¬åœ°éƒ¨ç½²

**ç¯å¢ƒè¦æ±‚**:
- Python 3.9+
- Node.js 18.19+
- 8GB RAM
- ç£ç›˜ç©ºé—´ 10GB+

**éƒ¨ç½²æ­¥éª¤**:

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/xxx/midscene-auto-test.git
cd midscene-auto-test

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# 3. å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# 4. å®‰è£… Node.js ä¾èµ–
npm install

# 5. å®‰è£…æµè§ˆå™¨
npx playwright install chromium

# 6. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env,å¡«å…¥ API Key

# 7. å¯åŠ¨åº”ç”¨
python src/ui/app.py
```

### 9.2 Docker éƒ¨ç½² (è¿­ä»£ 3)

**Dockerfile**:
```dockerfile
FROM python:3.9-slim

# å®‰è£… Node.js
RUN curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
RUN apt-get install -y nodejs

# å®‰è£… Playwright ä¾èµ–
RUN apt-get install -y \
    libnss3 \
    libatk-bridge2.0-0 \
    libxcomposite1 \
    libxdamage1

# å¤åˆ¶é¡¹ç›®
WORKDIR /app
COPY . .

# å®‰è£…ä¾èµ–
RUN pip install -r requirements.txt
RUN npm install
RUN npx playwright install chromium

# å¯åŠ¨
CMD ["python", "src/ui/app.py"]
```

### 9.3 æœåŠ¡å™¨éƒ¨ç½²

**nginx åå‘ä»£ç†**:
```nginx
server {
    listen 80;
    server_name auto-test.example.com;

    location / {
        proxy_pass http://127.0.0.1:7860;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

**systemd æœåŠ¡**:
```ini
[Unit]
Description=Auto Test Service
After=network.target

[Service]
Type=simple
User=webapp
WorkingDirectory=/opt/midscene-auto-test
ExecStart=/opt/midscene-auto-test/venv/bin/python src/ui/app.py
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

---

## 10. ç›‘æ§å’Œæ—¥å¿—

### 10.1 æ—¥å¿—ç³»ç»Ÿ

**æ—¥å¿—é…ç½®**:
```python
# src/utils/logger.py
import logging
import os
from datetime import datetime

def setup_logger(name: str) -> logging.Logger:
    """é…ç½®æ—¥å¿—"""

    logger = logging.getLogger(name)
    logger.setLevel(logging.INFO)

    # æ–‡ä»¶å¤„ç†å™¨
    log_dir = os.getenv('LOG_DIR', './logs')
    os.makedirs(log_dir, exist_ok=True)

    log_file = os.path.join(
        log_dir,
        f'app_{datetime.now().strftime("%Y%m%d")}.log'
    )

    file_handler = logging.FileHandler(log_file, encoding='utf-8')
    file_handler.setLevel(logging.INFO)

    # æ§åˆ¶å°å¤„ç†å™¨
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.INFO)

    # æ ¼å¼åŒ–
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    file_handler.setFormatter(formatter)
    console_handler.setFormatter(formatter)

    logger.addHandler(file_handler)
    logger.addHandler(console_handler)

    return logger
```

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from utils.logger import setup_logger

logger = setup_logger('TestCaseManager')

logger.info('å¼€å§‹æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹')
logger.warning('æ£€æµ‹åˆ°è­¦å‘Š')
logger.error('æ‰§è¡Œå¤±è´¥', exc_info=True)
```

### 10.2 æ€§èƒ½ç›‘æ§

**æ‰§è¡Œæ—¶é—´ç»Ÿè®¡**:
```python
import time
from functools import wraps

def timing_decorator(func):
    """æ‰§è¡Œæ—¶é—´è£…é¥°å™¨"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        duration = time.time() - start
        logger.info(f'{func.__name__} æ‰§è¡Œæ—¶é—´: {duration:.2f}s')
        return result
    return wrapper

@timing_decorator
def execute_yaml(yaml_content):
    # æ‰§è¡Œé€»è¾‘
    pass
```

### 10.3 é”™è¯¯è¿½è¸ª

**é”™è¯¯ç»Ÿè®¡**:
```python
class ErrorTracker:
    """é”™è¯¯è¿½è¸ªå™¨"""

    def __init__(self):
        self.errors = []

    def log_error(self, category: str, message: str):
        """è®°å½•é”™è¯¯"""
        self.errors.append({
            'category': category,
            'message': message,
            'timestamp': datetime.now().isoformat()
        })

    def get_summary(self) -> dict:
        """è·å–é”™è¯¯æ‘˜è¦"""
        from collections import Counter
        categories = [e['category'] for e in self.errors]
        return {
            'total': len(self.errors),
            'by_category': dict(Counter(categories))
        }
```

---

## æ€»ç»“

### æŠ€æœ¯äº®ç‚¹

1. âœ… **è·¨è¯­è¨€é›†æˆ**: Python + Node.js æ— ç¼åä½œ
2. âœ… **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„èŒè´£åˆ’åˆ†,æ˜“äºç»´æŠ¤
3. âœ… **å¤ç”¨æˆç†Ÿæ¡†æ¶**: æœ€å¤§åŒ–åˆ©ç”¨ Midscene.js èƒ½åŠ›
4. âœ… **å®‰å…¨å¯é **: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå®‰å…¨æªæ–½
5. âœ… **å¯æ‰©å±•æ€§å¼º**: ä¸ºåç»­è¿­ä»£é¢„ç•™æ¥å£

### æŠ€æœ¯é£é™©

| é£é™© | ç­‰çº§ | ç¼“è§£æªæ–½ |
|------|------|---------|
| Python-Node.js é€šä¿¡ä¸ç¨³å®š | ä¸­ | å®Œå–„é”™è¯¯å¤„ç†ã€æ—¥å¿—è®°å½• |
| LLM ç”Ÿæˆè´¨é‡ä¸ç¨³å®š | é«˜ | è¿­ä»£ä¼˜åŒ– Promptã€äººå·¥å®¡æ ¸ |
| æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ | ä½ | æä¾› Puppeteer å¤‡é€‰æ–¹æ¡ˆ |

### åç»­ä¼˜åŒ–æ–¹å‘

**çŸ­æœŸ**:
- æ·»åŠ æ›´è¯¦ç»†çš„æ—¥å¿—
- ä¼˜åŒ–é”™è¯¯æç¤º
- æå‡ UI å“åº”é€Ÿåº¦

**ä¸­æœŸ**:
- å®ç° HTTP API æ›¿ä»£ subprocess
- æ·»åŠ  Redis ç¼“å­˜
- æ”¯æŒåˆ†å¸ƒå¼æ‰§è¡Œ

**é•¿æœŸ**:
- å¾®æœåŠ¡æ¶æ„æ”¹é€ 
- Kubernetes éƒ¨ç½²
- ç›‘æ§å‘Šè­¦ç³»ç»Ÿ

---

**æ–‡æ¡£ç»“æŸ**

Â© 2025 å­™é¡ºè¾¾ ç‰ˆæƒæ‰€æœ‰
