# Midscene.js 测试用例模板
# 作者: 孙顺达
# 版本: v1.0
# 日期: 2025-01-12
# 说明: 基于 Midscene.js 的标准 YAML 测试用例格式

# ================================================================================
# 第一部分: 环境配置
# ================================================================================

web:
  # 必填: 测试网站 URL
  url: https://www.bing.com

  # 可选: 是否无头模式 (默认 false)
  headless: false

  # 可选: 浏览器窗口大小
  viewport:
    width: 1920
    height: 1080

  # 可选: 输出目录
  output: ./test-results.json

# ================================================================================
# 第二部分: 测试任务列表
# ================================================================================

tasks:
  # ============================================================================
  # 任务 1: 基础查询测试
  # 用途: 演示最简单的数据提取功能
  # ============================================================================
  - name: "基础查询测试 - 获取页面标题"
    flow:
      # aiQuery: 数据提取指令
      # 格式: aiQuery:
      #         demand: "<类型>, <提取内容描述>"
      #         name: <变量名>
      #
      # 支持的类型:
      # - string: 字符串
      # - number: 数字
      # - boolean: 布尔值
      # - array<string>: 字符串数组
      # - object: 对象
      - aiQuery:
          demand: "string, 获取页面标题"
          name: pageTitle

  # ============================================================================
  # 任务 2: 用户登录测试 (完整流程)
  # 用途: 演示完整的测试流程 (导航 → 操作 → 断言 → 验证)
  # ============================================================================
  - name: "用户登录功能 - 正常流程测试"
    flow:
      # 步骤 1: 使用 aiAction 执行复杂操作
      # aiAction: AI 会自动规划并执行多个步骤
      # 适合: 复杂的多步骤操作
      - aiAction: "找到页面右上角的登录按钮并点击"

      # 步骤 2: 等待页面响应
      # aiWaitFor: 等待某个条件满足
      # 重要: 关键操作后必须加等待,确保页面加载完成
      - aiWaitFor: "登录表单弹出或页面跳转到登录页面"

      # 步骤 3: 输入用户名
      # aiInput: 输入文本到指定元素
      # locate: 元素描述 (自然语言)
      # value: 要输入的内容
      - aiInput:
          locate: "用户名输入框"
          value: "test@example.com"

      # 步骤 4: 输入密码
      - aiInput:
          locate: "密码输入框"
          value: "password123"

      # 步骤 5: 点击提交按钮
      # aiTap: 点击元素 (简单操作)
      - aiTap: "提交按钮"

      # 步骤 6: 等待页面跳转
      - aiWaitFor: "页面完成跳转,URL 发生变化"

      # 步骤 7: 断言验证 (多个条件)
      # aiAssert: 验证页面状态
      # 技巧: 一个断言可以包含多个条件,用逗号分隔
      - aiAssert: "页面显示欢迎信息,包含用户名"
      - aiAssert: "页面右上角出现退出按钮"
      - aiAssert: "登录按钮已消失"

      # 步骤 8: 提取数据
      - aiQuery:
          demand: "string, 提取页面显示的用户名"
          name: displayedUsername

  # ============================================================================
  # 任务 3: 搜索功能测试
  # 用途: 演示搜索、数据提取、数组处理
  # ============================================================================
  - name: "搜索功能测试"
    flow:
      # 步骤 1: 点击搜索图标
      - aiTap: "搜索图标"

      # 步骤 2: 输入搜索关键词
      - aiInput:
          locate: "搜索输入框"
          value: "Midscene.js"

      # 步骤 3: 提交搜索 (使用 aiAction)
      - aiAction: "点击搜索按钮并等待结果加载"

      # 步骤 4: 提取数组数据
      # 技巧: 使用 array<string> 类型提取列表
      - aiQuery:
          demand: "array<string>, 提取前5条搜索结果的标题"
          name: searchResults

      # 步骤 5: 断言结果不为空
      - aiAssert: "搜索结果不为空,至少有3条结果"

      # 步骤 6: 提取对象数据 (高级用法)
      - aiQuery:
          demand: "object, 提取第一条搜索结果的信息,包含 title 和 url 字段"
          name: firstResult

  # ============================================================================
  # 任务 4: 表单填写测试
  # 用途: 演示表单处理、下拉框、复选框等
  # ============================================================================
  - name: "表单填写测试"
    flow:
      # 导航到表单页面
      - aiAction: "找到并点击注册链接"

      - aiWaitFor: "注册表单页面加载完成"

      # 填写文本输入框
      - aiInput:
          locate: "姓名输入框"
          value: "张三"

      - aiInput:
          locate: "邮箱输入框"
          value: "zhangsan@example.com"

      - aiInput:
          locate: "电话号码输入框"
          value: "13800138000"

      # 选择下拉框
      # 技巧: 使用 aiAction 描述选择操作
      - aiAction: "在性别下拉框中选择男"

      # 勾选复选框
      - aiAction: "勾选同意服务条款的复选框"

      # 提交表单
      - aiTap: "提交按钮"

      - aiWaitFor: "表单提交成功,显示成功消息"

      # 验证
      - aiAssert: "页面显示注册成功的提示信息"

  # ============================================================================
  # 任务 5: 页面滚动测试
  # 用途: 演示页面滚动、懒加载内容处理
  # ============================================================================
  - name: "页面滚动测试"
    flow:
      # 向下滚动页面
      # aiScroll: 滚动页面
      # direction: up / down / left / right
      - aiScroll:
          direction: down
          distance: 500

      # 等待懒加载内容出现
      - aiWaitFor: "页面底部的内容加载出来"

      # 滚动到特定元素
      - aiAction: "滚动页面直到看到页脚的联系我们链接"

      # 验证元素可见
      - aiAssert: "页脚的联系我们链接已可见"

  # ============================================================================
  # 任务 6: 多步骤交互测试
  # 用途: 演示复杂的多步骤交互流程
  # ============================================================================
  - name: "多步骤交互测试 - 购物车流程"
    flow:
      # 步骤 1: 搜索商品
      - aiAction: "在搜索框中输入商品名称并搜索"

      - aiWaitFor: "搜索结果页面加载完成"

      # 步骤 2: 选择商品
      - aiAction: "点击第一个搜索结果"

      - aiWaitFor: "商品详情页面加载完成"

      # 步骤 3: 加入购物车
      - aiTap: "加入购物车按钮"

      - aiWaitFor: "购物车图标显示商品数量"

      # 步骤 4: 进入购物车
      - aiTap: "购物车图标"

      - aiWaitFor: "购物车页面加载完成"

      # 步骤 5: 验证购物车内容
      - aiAssert: "购物车中有一件商品"

      # 步骤 6: 提取购物车信息
      - aiQuery:
          demand: "object, 提取购物车中的商品信息,包含名称、价格、数量"
          name: cartItem

  # ============================================================================
  # 任务 7: 条件判断测试 (高级用法)
  # 用途: 演示条件判断和分支逻辑
  # ============================================================================
  - name: "条件判断测试"
    flow:
      # 步骤 1: 检查登录状态
      - aiBoolean:
          demand: "用户是否已登录 (检查页面是否有退出按钮)"
          name: isLoggedIn

      # 步骤 2: 根据登录状态执行不同操作
      # 注意: Midscene 不直接支持 if-else,但可以通过任务分离实现
      # 这里仅作演示,实际使用时可以拆分为两个任务

      # 如果未登录,执行登录
      - aiAction: "如果未登录,点击登录按钮并完成登录"

  # ============================================================================
  # 任务 8: 错误处理测试
  # 用途: 演示如何处理预期的错误情况
  # ============================================================================
  - name: "错误处理测试 - 登录失败场景"
    flow:
      # 步骤 1: 点击登录
      - aiTap: "登录按钮"

      - aiWaitFor: "登录表单出现"

      # 步骤 2: 输入错误的用户名密码
      - aiInput:
          locate: "用户名输入框"
          value: "wrong_user"

      - aiInput:
          locate: "密码输入框"
          value: "wrong_password"

      # 步骤 3: 提交
      - aiTap: "提交按钮"

      - aiWaitFor: "页面显示错误提示"

      # 步骤 4: 验证错误提示
      - aiAssert: "页面显示用户名或密码错误的提示信息"

  # ============================================================================
  # 任务 9: 延迟等待测试
  # 用途: 演示固定时间等待 (不推荐,尽量使用 aiWaitFor)
  # ============================================================================
  - name: "延迟等待测试"
    flow:
      - aiTap: "提交按钮"

      # sleep: 固定等待 (秒)
      # 注意: 仅在必要时使用,优先使用 aiWaitFor
      - sleep: 3

      - aiAssert: "页面已更新"

  # ============================================================================
  # 任务 10: JavaScript 执行测试 (高级用法)
  # 用途: 演示在页面中执行自定义 JavaScript
  # ============================================================================
  - name: "JavaScript 执行测试"
    flow:
      # javascript: 在页面中执行 JavaScript 代码
      # 注意: 这是 Midscene 的扩展功能,不是标准指令
      # 实际使用时可能不支持,仅作参考
      - aiAction: "使用 JavaScript 设置某个隐藏字段的值"

# ================================================================================
# 第三部分: 编写技巧和最佳实践
# ================================================================================

# 1. 元素描述要具体明确
#    ✅ 好的描述: "页面右上角的蓝色登录按钮"
#    ❌ 不好的描述: "登录按钮"

# 2. 关键操作后必须加等待
#    ✅ 正确:
#        - aiTap: "提交按钮"
#        - aiWaitFor: "页面完成跳转"
#    ❌ 错误:
#        - aiTap: "提交按钮"
#        - aiAssert: "页面已跳转"  (可能页面还未跳转)

# 3. 断言要明确可验证
#    ✅ 好的断言: "页面显示欢迎信息,包含用户名,右上角有退出按钮"
#    ❌ 不好的断言: "登录成功"

# 4. 数据提取要指定类型
#    ✅ 正确: "string, 获取页面标题"
#    ✅ 正确: "array<string>, 获取搜索结果列表"
#    ❌ 错误: "获取标题"

# 5. 优先使用 aiWaitFor 而不是 sleep
#    ✅ 推荐: - aiWaitFor: "页面加载完成"
#    ❌ 不推荐: - sleep: 5

# 6. 复杂操作使用 aiAction,简单操作使用 aiTap
#    ✅ 复杂操作: - aiAction: "找到登录按钮并点击,然后等待表单出现"
#    ✅ 简单操作: - aiTap: "登录按钮"

# 7. 任务名称要清晰
#    ✅ 好的名称: "用户登录功能 - 正常流程测试"
#    ❌ 不好的名称: "测试1"

# 8. 每个任务专注于一个功能点
#    - 一个任务测试一个功能
#    - 避免一个任务测试多个无关功能

# ================================================================================
# 第四部分: Midscene 指令参考
# ================================================================================

# 指令列表:
# 1. aiAction: "<操作描述>"
#    - 用途: AI 自动规划并执行复杂操作
#    - 示例: aiAction: "在搜索框中输入关键词并搜索"

# 2. aiTap: "<元素描述>"
#    - 用途: 点击元素
#    - 示例: aiTap: "登录按钮"

# 3. aiInput:
#      locate: "<元素描述>"
#      value: "<输入内容>"
#    - 用途: 输入文本
#    - 示例: 见上文

# 4. aiAssert: "<断言描述>"
#    - 用途: 验证页面状态
#    - 示例: aiAssert: "页面显示成功消息"

# 5. aiQuery:
#      demand: "<类型>, <提取内容>"
#      name: <变量名>
#    - 用途: 提取数据
#    - 类型: string / number / boolean / array<string> / object
#    - 示例: 见上文

# 6. aiWaitFor: "<等待条件>"
#    - 用途: 等待条件满足
#    - 示例: aiWaitFor: "页面加载完成"

# 7. aiScroll:
#      direction: <方向>
#      distance: <距离>
#    - 用途: 滚动页面
#    - 方向: up / down / left / right
#    - 示例: 见上文

# 8. sleep: <秒数>
#    - 用途: 固定等待
#    - 示例: sleep: 3

# 9. aiBoolean:
#      demand: "<判断条件>"
#      name: <变量名>
#    - 用途: 条件判断
#    - 返回: true / false

# 10. aiNumber:
#       demand: "number, <提取数字>"
#       name: <变量名>
#     - 用途: 提取数字
#     - 示例: aiNumber:
#                demand: "number, 获取购物车商品数量"
#                name: cartCount

# 11. aiString:
#       demand: "string, <提取字符串>"
#       name: <变量名>
#     - 用途: 提取字符串 (等同于 aiQuery)

# 12. aiHover: "<元素描述>"
#     - 用途: 鼠标悬停
#     - 示例: aiHover: "下拉菜单"

# 13. aiRightClick: "<元素描述>"
#     - 用途: 右键点击
#     - 示例: aiRightClick: "文件名"

# 14. aiDoubleClick: "<元素描述>"
#     - 用途: 双击
#     - 示例: aiDoubleClick: "文件夹"

# 15. aiKeyboardPress:
#       key: <按键>
#     - 用途: 按键盘按键
#     - 示例: aiKeyboardPress:
#                key: "Enter"

# ================================================================================
# 第五部分: 常见场景示例
# ================================================================================

# 场景 1: 文件上传
# - aiAction: "点击上传按钮,选择文件 test.jpg"

# 场景 2: 下拉框选择
# - aiAction: "在地区下拉框中选择北京"

# 场景 3: 日期选择
# - aiAction: "在日期选择器中选择 2025-01-15"

# 场景 4: 多选框勾选
# - aiAction: "勾选所有兴趣爱好的复选框"

# 场景 5: 拖拽操作
# - aiAction: "将文件图标拖拽到回收站"

# 场景 6: 弹窗处理
# - aiAction: "点击确认按钮关闭弹窗"

# 场景 7: 新标签页处理
# - aiAction: "点击链接,在新标签页中打开"
# 注意: Midscene 会自动切换到新标签页

# 场景 8: iframe 处理
# - aiAction: "在 iframe 中找到提交按钮并点击"
# 注意: Midscene 会自动处理 iframe

# ================================================================================
# 第六部分: 调试技巧
# ================================================================================

# 1. 使用 aiQuery 调试
#    - 不确定元素是否存在时,先用 aiQuery 提取信息
#    - 示例: aiQuery:
#               demand: "boolean, 页面是否有登录按钮"
#               name: hasLoginButton

# 2. 分步执行
#    - 复杂流程拆分为多个小步骤
#    - 每步后加 aiWaitFor 确保完成

# 3. 查看报告
#    - Midscene 会自动生成详细的 HTML 报告
#    - 报告包含每步截图和 AI 思考过程

# 4. 启用非无头模式
#    - 设置 headless: false
#    - 可以看到浏览器实际操作过程

# 5. 使用 aiAssert 验证中间状态
#    - 在关键步骤后加断言
#    - 确保流程按预期执行

# ================================================================================
# 第七部分: 注意事项
# ================================================================================

# 1. YAML 格式要求
#    - 使用空格缩进,不要使用 Tab
#    - 冒号后必须有空格
#    - 字符串包含特殊字符时需要加引号

# 2. 性能优化
#    - 避免不必要的 sleep
#    - 使用 aiWaitFor 替代固定等待
#    - 复用登录状态 (可以在第一个任务登录,后续任务使用)

# 3. 测试用例独立性
#    - 每个任务应该能独立执行
#    - 不要依赖其他任务的状态

# 4. 元素定位稳定性
#    - 元素描述要足够具体
#    - 避免使用容易变化的文本 (如数字)

# 5. 错误处理
#    - 预期的错误场景也要测试
#    - 使用 aiAssert 验证错误提示

# ================================================================================
# 第八部分: 更多资源
# ================================================================================

# 官方文档: https://midscenejs.com
# GitHub: https://github.com/web-infra-dev/midscene
# 示例项目: https://github.com/web-infra-dev/midscene-example

# 作者联系方式:
# 邮箱: [待补充]
# 微信: [待补充]

# ================================================================================
# 文档结束
# ================================================================================
# © 2025 孙顺达 版权所有
